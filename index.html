<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Metro Cavite Bus Tracker</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cyber: { dark: '#0f172a', cyan: '#06b6d4', red: '#ef4444' }
                    },
                    fontFamily: {
                        mono: ['ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', "Liberation Mono", "Courier New", 'monospace'],
                    },
                    animation: {
                        'flash-red': 'flashRed 1s infinite',
                    },
                    keyframes: {
                        flashRed: {
                            '0%, 100%': { backgroundColor: 'transparent' },
                            '50%': { backgroundColor: 'rgba(239, 68, 68, 0.3)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Local CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-slate-950 font-sans text-gray-200 overflow-hidden selection:bg-cyan-500 selection:text-white">

    <!-- App Container -->
    <div id="app" class="relative h-screen w-full overflow-hidden">
        
        <!-- Sidebar Wrapper -->
        <div id="sidebar-wrapper" class="absolute top-0 left-0 h-full z-[2000] flex transition-transform duration-300 ease-in-out">
            
            <!-- Sidebar Content Panel -->
            <div id="sidebar" class="w-[85vw] md:w-[450px] h-full glass-panel flex flex-col border-r border-cyan-500/30 relative">
                
                <!-- Header -->
                <div class="p-4 md:p-6 border-b border-gray-800 flex justify-between items-center bg-slate-900/50">
                    <div class="flex items-center gap-4">
                        <i class="fa-solid fa-bus text-cyan-400 text-3xl"></i>
                        <div class="flex flex-col">
                            <h1 class="text-xl font-bold text-white tracking-widest neon-text leading-none uppercase">
                                Metro Cavite
                            </h1>
                            <p class="text-cyan-500/50 text-[10px] tracking-[0.3em] font-mono uppercase mt-1">Live Tracking Sys.</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-mono font-bold text-cyan-400 text-lg" id="clock">00:00</div>
                    </div>
                </div>

                <!-- Tab Navigation -->
                <div class="flex p-2 gap-2 bg-slate-900/50 border-b border-gray-800 shrink-0">
                    <button class="tab-btn flex-1 py-3 text-[10px] font-bold tracking-widest text-gray-400 hover:text-cyan-400 transition rounded border border-transparent active-tab uppercase" data-tab="passenger">
                        <i class="fa-solid fa-users mb-1 block"></i>Passenger
                    </button>
                    <button class="tab-btn flex-1 py-3 text-[10px] font-bold tracking-widest text-gray-400 hover:text-green-400 transition rounded border border-transparent uppercase" data-tab="driver">
                        <i class="fa-solid fa-id-card mb-1 block"></i>Driver
                    </button>
                    <button class="tab-btn flex-1 py-3 text-[10px] font-bold tracking-widest text-gray-400 hover:text-purple-400 transition rounded border border-transparent uppercase" data-tab="operator">
                        <i class="fa-solid fa-tower-broadcast mb-1 block"></i>Operator
                    </button>
                </div>

                <!-- Scrollable Content Area -->
                <div class="flex-1 overflow-y-auto p-4 relative custom-scrollbar" id="content-area">
                    
                    <!-- ================= PASSENGER VIEW ================= -->
                    <div id="view-passenger" class="view-section space-y-4">
                        <div class="bg-slate-800/50 p-2 rounded border border-gray-700 flex items-center gap-2 focus-within:border-cyan-500 transition-colors">
                            <div class="p-2 text-cyan-500"><i class="fa-solid fa-search"></i></div>
                            <input type="text" id="passenger-search" placeholder="Search Bus / Route..." class="bg-transparent w-full outline-none text-sm text-white placeholder-gray-600 font-mono uppercase">
                        </div>

                        <!-- Traffic Legend -->
                        <div class="bg-slate-900/60 p-3 rounded border border-gray-700 grid grid-cols-2 gap-2">
                            <div class="col-span-2 text-[9px] text-gray-500 font-mono uppercase tracking-widest mb-1">Live Status Indicators</div>
                            <div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-green-500"></span><span class="text-[10px] text-gray-400">ARRIVED</span></div>
                            <div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-yellow-400"></span><span class="text-[10px] text-gray-400">ARRIVING</span></div>
                            <div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-orange-500"></span><span class="text-[10px] text-gray-400">DEPARTING</span></div>
                            <div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-red-500"></span><span class="text-[10px] text-gray-400">DEPARTED</span></div>
                        </div>

                        <div class="bg-slate-800/30 rounded border border-gray-700/50 overflow-hidden backdrop-blur-sm h-[400px] flex flex-col">
                            <div class="bg-slate-900/80 px-4 py-3 border-b border-gray-700 flex justify-between items-center shrink-0">
                                <span class="text-xs font-bold text-cyan-400 uppercase tracking-widest"><i class="fa-solid fa-satellite-dish mr-2"></i>Live Feed</span>
                                <span class="h-1.5 w-1.5 rounded-full bg-cyan-500 animate-pulse"></span>
                            </div>
                            <div class="divide-y divide-gray-800 overflow-y-auto custom-scrollbar flex-1" id="arrival-board">
                                <div class="text-center text-gray-500 py-12 text-xs font-mono tracking-widest flex flex-col items-center">
                                    <i class="fa-solid fa-circle-notch fa-spin text-cyan-500/20 text-3xl mb-3"></i>
                                    <span>SCANNING FREQUENCIES...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ================= DRIVER VIEW ================= -->
                    <div id="view-driver" class="view-section hidden space-y-4">
                        
                        <!-- Driver Login/Signup Container -->
                        <div id="driver-auth-container">
                            <!-- Toggle -->
                            <div class="flex gap-2 mb-4 bg-slate-900 p-1 rounded">
                                <button onclick="toggleDriverAuth('login')" class="flex-1 py-2 text-xs font-bold uppercase rounded bg-slate-800 text-white" id="btn-d-login">Login</button>
                                <button onclick="toggleDriverAuth('signup')" class="flex-1 py-2 text-xs font-bold uppercase rounded text-gray-500 hover:text-white" id="btn-d-signup">Sign Up</button>
                            </div>

                            <!-- Driver Login -->
                            <form id="driver-login-form" class="space-y-4">
                                <h3 class="text-green-400 font-bold uppercase tracking-widest text-sm border-b border-gray-700 pb-2">Driver Portal</h3>
                                <input type="text" id="d-login-user" placeholder="USERNAME" class="w-full bg-slate-900 border border-gray-700 rounded p-3 text-xs text-white outline-none focus:border-green-500 font-mono">
                                <input type="password" id="d-login-pass" placeholder="PASSWORD" class="w-full bg-slate-900 border border-gray-700 rounded p-3 text-xs text-white outline-none focus:border-green-500 font-mono">
                                <button type="submit" class="w-full bg-green-600 hover:bg-green-500 text-white py-3 rounded text-xs font-bold tracking-[0.2em] uppercase transition-all">Start System</button>
                            </form>

                            <!-- Driver Signup -->
                            <form id="driver-signup-form" class="space-y-3 hidden">
                                <h3 class="text-green-400 font-bold uppercase tracking-widest text-sm border-b border-gray-700 pb-2">Driver Registration</h3>
                                <input type="text" id="d-reg-name" placeholder="FULL NAME" required class="w-full bg-slate-900 border border-gray-700 rounded p-3 text-xs text-white outline-none focus:border-green-500 font-mono uppercase">
                                <input type="date" id="d-reg-dob" required class="w-full bg-slate-900 border border-gray-700 rounded p-3 text-xs text-white outline-none focus:border-green-500 font-mono uppercase text-gray-400">
                                <select id="d-reg-company" required class="w-full bg-slate-900 border border-gray-700 rounded p-3 text-xs text-white outline-none focus:border-green-500 font-mono uppercase">
                                    <option value="" disabled selected>SELECT BUS COMPANY</option>
                                    <!-- Companies Populated via JS -->
                                </select>
                                <input type="text" id="d-reg-user" placeholder="USERNAME" required class="w-full bg-slate-900 border border-gray-700 rounded p-3 text-xs text-white outline-none focus:border-green-500 font-mono">
                                <input type="password" id="d-reg-pass" placeholder="PASSWORD" required class="w-full bg-slate-900 border border-gray-700 rounded p-3 text-xs text-white outline-none focus:border-green-500 font-mono">
                                <button type="submit" class="w-full bg-green-900/50 border border-green-500 text-green-400 hover:bg-green-800/50 py-3 rounded text-xs font-bold tracking-[0.2em] uppercase transition-all">Submit Application</button>
                            </form>
                        </div>

                        <!-- Driver Dashboard (Hidden by default) -->
                        <div id="driver-dashboard" class="hidden space-y-4">
                            <div class="bg-slate-800/40 p-4 rounded border border-green-500/30">
                                <h2 class="font-bold text-lg text-white" id="dash-driver-name">Driver Name</h2>
                                <p class="text-green-500/70 text-[10px] font-mono uppercase tracking-widest" id="dash-driver-company">Company</p>
                                <button onclick="logout()" class="mt-2 text-[9px] text-red-400 border border-red-500/30 px-2 py-1 rounded">LOGOUT</button>
                            </div>

                            <div id="shift-controls" class="bg-slate-900/80 p-5 rounded border border-gray-800 shadow-inner">
                                <div class="mb-4">
                                    <label class="text-[9px] text-gray-500 uppercase block mb-1">Select Route</label>
                                    <select id="shift-route" class="w-full p-3 bg-slate-950 border border-gray-700 rounded text-sm text-white font-mono focus:border-green-500 outline-none uppercase">
                                        <!-- Routes populated by JS -->
                                    </select>
                                </div>
                                <div class="mb-4">
                                    <label class="text-[9px] text-gray-500 uppercase block mb-1">Status Indicator</label>
                                    <select id="shift-status" class="w-full p-3 bg-slate-950 border border-gray-700 rounded text-sm text-white font-mono focus:border-green-500 outline-none uppercase">
                                        <option value="departing">Departing (Orange)</option>
                                        <option value="departed">Departed (Red)</option>
                                        <option value="arriving">Arriving (Yellow)</option>
                                        <option value="arrived">Arrived (Green)</option>
                                    </select>
                                </div>
                                <button id="btn-shift" class="w-full py-4 rounded bg-gradient-to-r from-green-900 to-green-800 border border-green-500/50 text-green-400 font-bold tracking-[0.2em] shadow-[0_0_20px_rgba(16,185,129,0.1)] transition-all flex items-center justify-center gap-3">
                                    <i class="fa-solid fa-power-off"></i> <span>START SHIFT</span>
                                </button>
                            </div>
                            
                            <!-- Telemetry -->
                            <div id="telemetry-panel" class="hidden grid grid-cols-2 gap-3">
                                <div class="bg-slate-900 p-4 rounded border border-gray-800">
                                    <div class="text-[9px] text-gray-500 font-mono tracking-widest mb-1">SPEED</div>
                                    <div class="text-3xl font-mono font-bold text-cyan-400" id="telemetry-speed">0 <span class="text-xs">km/h</span></div>
                                </div>
                                <div class="bg-slate-900 p-4 rounded border border-gray-800">
                                    <div class="text-[9px] text-gray-500 font-mono tracking-widest mb-1">GPS STATUS</div>
                                    <div class="text-xs font-bold text-green-400 animate-pulse">ACTIVE</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ================= OPERATOR VIEW ================= -->
                    <div id="view-operator" class="view-section hidden space-y-4">
                        
                        <!-- Operator Auth -->
                        <div id="operator-auth-container">
                            <div class="flex gap-2 mb-4 bg-slate-900 p-1 rounded">
                                <button onclick="toggleOperatorAuth('login')" class="flex-1 py-2 text-xs font-bold uppercase rounded bg-slate-800 text-white" id="btn-op-login">Login</button>
                                <button onclick="toggleOperatorAuth('signup')" class="flex-1 py-2 text-xs font-bold uppercase rounded text-gray-500 hover:text-white" id="btn-op-signup">Sign Up</button>
                            </div>

                            <form id="op-login-form" class="space-y-4">
                                <h3 class="text-purple-400 font-bold uppercase tracking-widest text-sm border-b border-gray-700 pb-2">Operator Command</h3>
                                <input type="text" id="op-login-user" placeholder="USERNAME" class="w-full bg-slate-900 border border-gray-700 rounded p-3 text-xs text-white outline-none focus:border-purple-500 font-mono">
                                <input type="password" id="op-login-pass" placeholder="PASSWORD" class="w-full bg-slate-900 border border-gray-700 rounded p-3 text-xs text-white outline-none focus:border-purple-500 font-mono">
                                <button type="submit" class="w-full bg-purple-600 hover:bg-purple-500 text-white py-3 rounded text-xs font-bold tracking-[0.2em] uppercase transition-all">Access Console</button>
                            </form>

                            <form id="op-signup-form" class="space-y-3 hidden">
                                <h3 class="text-purple-400 font-bold uppercase tracking-widest text-sm border-b border-gray-700 pb-2">Fleet Registration</h3>
                                <select id="op-reg-company" required class="w-full bg-slate-900 border border-gray-700 rounded p-3 text-xs text-white outline-none focus:border-purple-500 font-mono uppercase">
                                    <option value="" disabled selected>SELECT YOUR COMPANY</option>
                                    <!-- Populated by JS -->
                                </select>
                                <input type="text" id="op-reg-address" placeholder="HQ ADDRESS" required class="w-full bg-slate-900 border border-gray-700 rounded p-3 text-xs text-white outline-none focus:border-purple-500 font-mono uppercase">
                                <input type="text" id="op-reg-user" placeholder="USERNAME" required class="w-full bg-slate-900 border border-gray-700 rounded p-3 text-xs text-white outline-none focus:border-purple-500 font-mono">
                                <input type="password" id="op-reg-pass" placeholder="PASSWORD" required class="w-full bg-slate-900 border border-gray-700 rounded p-3 text-xs text-white outline-none focus:border-purple-500 font-mono">
                                <button type="submit" class="w-full bg-purple-900/50 border border-purple-500 text-purple-400 hover:bg-purple-800/50 py-3 rounded text-xs font-bold tracking-[0.2em] uppercase transition-all">Register Fleet</button>
                            </form>
                        </div>

                        <!-- Operator Dashboard -->
                        <div id="operator-dashboard" class="hidden space-y-4">
                            <div class="bg-purple-900/20 border border-purple-500/30 p-4 rounded flex justify-between items-center backdrop-blur-sm">
                                <div>
                                    <h2 class="font-bold text-lg text-white" id="dash-op-company">Company Name</h2>
                                    <div class="flex items-center gap-2">
                                        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                        <p class="text-purple-300 text-[10px] font-mono tracking-widest">SYSTEM ONLINE</p>
                                    </div>
                                </div>
                                <button onclick="logout()" class="text-[10px] text-purple-300 border border-purple-500/50 px-3 py-1 rounded hover:bg-purple-500/20 transition">DISCONNECT</button>
                            </div>

                            <!-- Driver Approval Section -->
                            <div class="bg-slate-800/40 rounded border border-yellow-600/30 flex flex-col">
                                <div class="bg-slate-900/50 px-4 py-2 border-b border-gray-700 font-bold text-yellow-500 text-[10px] uppercase tracking-widest flex justify-between items-center">
                                    <span><i class="fa-solid fa-user-plus mr-2"></i>New Driver Requests</span>
                                    <span id="req-count" class="bg-yellow-500 text-black px-1.5 rounded text-[9px] font-bold">0</span>
                                </div>
                                <div id="op-requests-list" class="max-h-[150px] overflow-y-auto custom-scrollbar p-2 space-y-2">
                                    <div class="text-center text-gray-600 text-[10px] font-mono py-2">NO PENDING REQUESTS</div>
                                </div>
                            </div>

                            <!-- Shift Logs -->
                            <div class="bg-slate-800/40 rounded border border-gray-700 h-[250px] flex flex-col">
                                <div class="bg-slate-900/50 px-4 py-2 border-b border-gray-700 font-bold text-gray-400 text-[10px] uppercase tracking-widest">Shift Logs (Today)</div>
                                <div id="op-logs-list" class="divide-y divide-gray-800 overflow-y-auto custom-scrollbar flex-1">
                                    <!-- Logs populated by JS -->
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                
                <!-- Footer -->
                <div class="p-3 text-center text-[9px] text-gray-600 bg-slate-900/80 border-t border-gray-800 font-mono">
                    The Metro Cavite v4.0 // <span class="text-cyan-900">SECURE CONNECTION</span>
                </div>
            </div>

            <!-- Toggle Handle Button -->
            <button id="sidebar-toggle-btn" class="h-24 w-6 bg-slate-900 border-y border-r border-cyan-500/50 text-cyan-400 rounded-r-lg self-center flex items-center justify-center hover:bg-slate-800 focus:outline-none shadow-[5px_0_15px_rgba(0,0,0,0.5)] z-[2001] cursor-pointer group">
                <i id="sidebar-icon" class="fa-solid fa-chevron-left text-xs transition-transform duration-300 group-hover:scale-125"></i>
            </button>

        </div>

        <!-- Right Side: The Map -->
        <div class="absolute inset-0 z-0 bg-slate-950" id="map-container">
            <div id="map" class="h-full w-full"></div>
        </div>

    </div>

    <!-- Main Module -->
    <script type="module" src="app.js"></script>
    <script>
        const sidebarWrapper = document.getElementById('sidebar-wrapper');
        const sidebarToggleBtn = document.getElementById('sidebar-toggle-btn');
        const sidebarIcon = document.getElementById('sidebar-icon');
        let isSidebarOpen = true;

        sidebarToggleBtn.addEventListener('click', () => {
            isSidebarOpen = !isSidebarOpen;
            if(isSidebarOpen) {
                sidebarWrapper.style.transform = 'translateX(0)';
                sidebarIcon.classList.remove('rotate-180');
            } else {
                sidebarWrapper.style.transform = 'translateX(-100%)';
                sidebarIcon.classList.add('rotate-180');
            }
        });

        // Tab Switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active-tab', 'text-cyan-400', 'text-green-400', 'text-purple-400'));
                const target = e.currentTarget;
                target.classList.add('active-tab');
                
                // Color Logic
                const tab = target.dataset.tab;
                if(tab === 'passenger') target.classList.add('text-cyan-400');
                if(tab === 'driver') target.classList.add('text-green-400');
                if(tab === 'operator') target.classList.add('text-purple-400');

                document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
                document.getElementById(`view-${tab}`).classList.remove('hidden');
            });
        });

        // Auth Toggles
        window.toggleDriverAuth = (mode) => {
            if(mode === 'login') {
                document.getElementById('driver-login-form').classList.remove('hidden');
                document.getElementById('driver-signup-form').classList.add('hidden');
                document.getElementById('btn-d-login').classList.replace('text-gray-500', 'text-white');
                document.getElementById('btn-d-login').classList.replace('bg-transparent', 'bg-slate-800');
                document.getElementById('btn-d-signup').classList.replace('text-white', 'text-gray-500');
                document.getElementById('btn-d-signup').classList.replace('bg-slate-800', 'bg-transparent');
            } else {
                document.getElementById('driver-login-form').classList.add('hidden');
                document.getElementById('driver-signup-form').classList.remove('hidden');
                document.getElementById('btn-d-signup').classList.replace('text-gray-500', 'text-white');
                document.getElementById('btn-d-signup').classList.replace('bg-transparent', 'bg-slate-800');
                document.getElementById('btn-d-login').classList.replace('text-white', 'text-gray-500');
                document.getElementById('btn-d-login').classList.replace('bg-slate-800', 'bg-transparent');
            }
        }

        window.toggleOperatorAuth = (mode) => {
            // Same logic as driver, simplified
            if(mode === 'login') {
                document.getElementById('op-login-form').classList.remove('hidden');
                document.getElementById('op-signup-form').classList.add('hidden');
            } else {
                document.getElementById('op-login-form').classList.add('hidden');
                document.getElementById('op-signup-form').classList.remove('hidden');
            }
        }

        setInterval(() => {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('en-US', {hour12: false});
        }, 1000);
    </script>
</body>
</html>