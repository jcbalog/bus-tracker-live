<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Metro Cavite Bus Tracker</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cyber: { dark: '#0f172a', cyan: '#06b6d4' }
                    },
                    fontFamily: {
                        mono: ['ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', "Liberation Mono", "Courier New", 'monospace'],
                    }
                }
            }
        }
    </script>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Local CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-slate-950 font-sans text-gray-200 overflow-hidden selection:bg-cyan-500 selection:text-white">

    <!-- MFA / 2FA MODAL -->
    <div id="mfa-modal" class="fixed inset-0 bg-black/90 z-[3000] hidden flex items-center justify-centerXH backdrop-blur-sm">
        <div class="bg-slate-900 p-8 rounded-lg border border-cyan-500 w-96 shadow-[0_0_50px_rgba(6,182,212,0.3)]">
            <h3 class="text-cyan-400 font-bold mb-2 text-xl tracking-wider" id="mfa-title">2-FACTOR SECURITY</h3>
            <div id="mfa-step-1">
                <p class="text-xs text-gray-400 mb-4 font-mono">MANDATORY: Register mobile number for secure access.</p>
                <input type="text" id="mfa-phone" placeholder="+63 9XX XXX XXXX" class="w-full bg-slate-950 border border-slate-700 p-3 rounded text-white mb-4 outline-none focus:border-cyan-500 font-mono text-sm">
                <button id="btn-send-code" class="w-full bg-cyan-600 hover:bg-cyan-500 text-white p-3 rounded font-bold tracking-widest text-xs transition-all">SEND VERIFICATION CODE</button>
            </div>
            <div id="mfa-step-2" class="hidden">
                <p class="text-xs text-gray-400 mb-4 font-mono" id="mfa-msg">Enter the 6-digit code sent to your device.</p>
                <input type="text" id="mfa-code" placeholder="XXXXXX" class="w-full bg-slate-950 border border-slate-700 p-3 rounded text-white mb-4 outline-none focus:border-green-500 font-mono text-center text-lg tracking-[0.5em]">
                <button id="btn-verify-code" class="w-full bg-green-600 hover:bg-green-500 text-white p-3 rounded font-bold tracking-widest text-xs transition-all">VERIFY & ACCESS</button>
            </div>
            <div id="recaptcha-container"></div>
        </div>
    </div>

    <!-- App Container -->
    <div id="app" class="relative h-screen w-full overflow-hidden">
        
        <!-- Sidebar Wrapper -->
        <div id="sidebar-wrapper" class="absolute top-0 left-0 h-full z-[2000] flex transition-transform duration-300 ease-in-out">
            
            <!-- Sidebar Content Panel -->
            <div id="sidebar" class="w-[85vw] md:w-[450px] h-full glass-panel flex flex-col border-r border-cyan-500/30 relative">
                
                <!-- Header -->
                <div class="p-4 md:p-6 border-b border-gray-800 flex justify-between items-center bg-slate-900/50">
                    <div class="flex items-center gap-4">
                        <i class="fa-solid fa-bus text-cyan-400 animate-pulse text-3xl"></i>
                        <div class="flex flex-col">
                            <h1 class="text-xl font-bold text-white tracking-wider neon-text leading-none">
                                Metro Cavite
                            </h1>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="relative flex h-1.5 w-1.5">
                                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-cyan-400 opacity-75"></span>
                                  <span class="relative inline-flex rounded-full h-1.5 w-1.5 bg-cyan-500"></span>
                                </span>
                                <p class="text-cyan-200/70 text-[9px] tracking-[0.2em] font-mono uppercase leading-none">Live Tracker</p>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-[9px] text-gray-500 font-mono tracking-widest mb-1">SYS.TIME</div>
                        <div class="font-mono font-bold text-cyan-400 text-lg leading-none" id="clock">00:00:00</div>
                    </div>
                </div>

                <!-- Tab Navigation (Fixed) -->
                <div class="flex p-1 bg-slate-900/80 border-b border-gray-800 shrink-0 gap-1">
                    <button class="tab-btn active-tab flex-1 py-3 text-[10px] md:text-xs font-bold tracking-wider text-gray-400 hover:text-cyan-400 transition-all rounded cursor-pointer flex items-center justify-center gap-2" data-tab="passenger">
                        <i class="fa-solid fa-users"></i> PASSENGER
                    </button>
                    <button class="tab-btn flex-1 py-3 text-[10px] md:text-xs font-bold tracking-wider text-gray-400 hover:text-cyan-400 transition-all rounded cursor-pointer flex items-center justify-center gap-2" data-tab="driver">
                        <i class="fa-solid fa-id-card"></i> DRIVER
                    </button>
                    <button class="tab-btn flex-1 py-3 text-[10px] md:text-xs font-bold tracking-wider text-gray-400 hover:text-cyan-400 transition-all rounded cursor-pointer flex items-center justify-center gap-2" data-tab="operator">
                        <i class="fa-solid fa-tower-broadcast"></i> OPERATOR
                    </button>
                </div>

                <!-- Scrollable Content Area -->
                <div class="flex-1 overflow-y-auto p-4 relative custom-scrollbar" id="content-area">
                    
                    <!-- PASSENGER VIEW -->
                    <div id="view-passenger" class="view-section space-y-4">
                        <div class="bg-slate-800/50 p-3 rounded border border-gray-700 flex items-center gap-2 focus-within:border-cyan-500 transition-colors">
                            <div class="p-1 text-cyan-400"><i class="fa-solid fa-search"></i></div>
                            <input type="text" placeholder="SEARCH BUS ID / ROUTE..." class="bg-transparent w-full outline-none text-sm text-white placeholder-gray-600 font-mono">
                        </div>

                        <!-- Traffic Legend -->
                        <div class="bg-slate-900/60 p-3 rounded border border-gray-700">
                            <p class="text-[10px] text-gray-400 font-mono mb-2 uppercase tracking-widest">Traffic Density Index</p>
                            <div class="flex justify-between gap-1">
                                <div class="flex items-center gap-1">
                                    <span class="w-3 h-1 bg-green-500 rounded"></span>
                                    <span class="text-[9px] text-green-500 font-bold">CLEAR</span>
                                </div>
                                 <div class="flex items-center gap-1">
                                    <span class="w-3 h-1 bg-yellow-400 rounded"></span>
                                    <span class="text-[9px] text-yellow-400 font-bold">LIGHT</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <span class="w-3 h-1 bg-red-500 rounded"></span>
                                    <span class="text-[9px] text-red-500 font-bold">HEAVY</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-slate-800/30 rounded border border-gray-700/50 overflow-hidden backdrop-blur-sm">
                            <div class="bg-slate-900/80 px-4 py-3 border-b border-gray-700 flex justify-between items-center">
                                <span class="text-xs font-bold text-cyan-400 uppercase tracking-widest"><i class="fa-solid fa-list-ul mr-2"></i>Live Feed</span>
                                <span class="h-1.5 w-1.5 rounded-full bg-cyan-500 animate-pulse"></span>
                            </div>
                            <div class="divide-y divide-gray-800 max-h-[400px] overflow-y-auto custom-scrollbar" id="arrival-board">
                                <div class="text-center text-gray-500 py-12 text-xs font-mono tracking-widest">
                                    <i class="fa-solid fa-circle-notch fa-spin text-cyan-500/50 text-2xl mb-3"></i><br>
                                    AWAITING SATELLITE HANDSHAKE...
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DRIVER VIEW -->
                    <div id="view-driver" class="view-section hidden space-y-4">
                        <div id="driver-auth" class="bg-slate-800/40 p-6 rounded border border-gray-700 relative overflow-hidden group">
                            <h3 class="text-lg font-bold mb-6 text-white tracking-widest uppercase border-b border-gray-700 pb-2">Driver Access</h3>
                            
                            <!-- Social Login -->
                            <div class="space-y-3 mb-6">
                                <button id="btn-google-driver" class="w-full bg-white text-gray-900 p-3 rounded font-bold text-xs flex items-center justify-center gap-3 hover:bg-gray-200 transition">
                                    <i class="fa-brands fa-google text-red-500 text-lg"></i> Sign in with Google
                                </button>
                                <button id="btn-ms-driver" class="w-full bg-[#00a4ef] text-white p-3 rounded font-bold text-xs flex items-center justify-center gap-3 hover:bg-[#0078d4] transition border border-transparent">
                                    <i class="fa-brands fa-microsoft text-white text-lg"></i> Sign in with Microsoft
                                </button>
                            </div>

                            <!-- Manual Login Fallback -->
                            <div class="relative flex py-2 items-center">
                                <div class="flex-grow border-t border-gray-700"></div>
                                <span class="flex-shrink-0 mx-4 text-gray-500 text-[10px] uppercase">Or use fleet ID</span>
                                <div class="flex-grow border-t border-gray-700"></div>
                            </div>

                            <form id="driver-login-form" class="space-y-4 pt-2">
                                <div class="space-y-1">
                                    <input type="text" placeholder="FLEET ID / EMAIL" id="d-login-user" class="w-full bg-slate-900 border border-gray-700 rounded p-3 text-sm focus:border-cyan-500 outline-none text-white font-mono transition-colors">
                                </div>
                                <div class="space-y-1">
                                    <input type="password" placeholder="PASSCODE" id="d-login-pass" class="w-full bg-slate-900 border border-gray-700 rounded p-3 text-sm focus:border-cyan-500 outline-none text-white font-mono transition-colors">
                                </div>
                                <button type="submit" class="w-full bg-cyan-600/20 hover:bg-cyan-600/40 text-cyan-400 border border-cyan-500/50 py-3 rounded text-xs font-bold tracking-widest uppercase transition-all shadow-[0_0_15px_rgba(6,182,212,0.1)]">Authenticate</button>
                            </form>
                        </div>

                        <!-- Driver Dashboard -->
                        <div id="driver-dashboard" class="hidden space-y-4">
                            <div class="bg-slate-800/40 p-4 rounded border border-green-500/30 flex justify-between items-start">
                                <div>
                                    <h2 class="font-bold text-lg text-white tracking-wide" id="driver-name-display">Driver Name</h2>
                                    <p class="text-green-500/70 text-[10px] font-mono uppercase tracking-widest mt-1" id="driver-company-display">Company</p>
                                </div>
                                <div class="text-right">
                                    <span class="bg-green-900/30 text-green-400 text-[10px] px-3 py-1 rounded border border-green-500/30 uppercase tracking-wider font-bold animate-pulse" id="driver-status-badge">Online</span>
                                </div>
                            </div>

                            <div class="bg-slate-900/80 p-5 rounded border border-gray-800 shadow-inner">
                                <h3 class="text-gray-500 text-[10px] uppercase tracking-widest mb-3 font-bold">Shift Configuration</h3>
                                <div class="mb-4">
                                    <select id="shift-route" class="w-full p-3 bg-slate-950 border border-gray-700 rounded text-sm text-gray-300 font-mono focus:border-green-500 outline-none uppercase">
                                        <option value="1">R1 // PITX :: TERNATE</option>
                                        <option value="2">R2 // PITX :: PALA-PALA</option>
                                        <option value="3">R3 // PITX :: TRECE</option>
                                    </select>
                                </div>
                                <div class="flex items-center gap-2 mb-4 p-3 bg-slate-950 rounded border border-gray-700">
                                    <input type="checkbox" id="gps-toggle" class="w-4 h-4 accent-green-500">
                                    <label for="gps-toggle" class="text-xs font-bold text-gray-400 uppercase cursor-pointer select-none">Link Device GPS</label>
                                </div>
                                <button id="btn-shift" class="w-full py-4 rounded bg-gradient-to-r from-green-900/50 to-green-800/50 border border-green-500/50 text-green-400 font-bold tracking-[0.2em] shadow-[0_0_20px_rgba(16,185,129,0.1)] hover:shadow-[0_0_30px_rgba(16,185,129,0.3)] transition-all flex items-center justify-center gap-3 group">
                                    <i class="fa-solid fa-power-off group-hover:animate-pulse"></i> <span>INITIATE SHIFT</span>
                                </button>
                            </div>
                            
                            <!-- Telemetry -->
                            <div id="telemetry-panel" class="hidden grid grid-cols-2 gap-3">
                                <div class="bg-slate-900/90 border border-gray-800 p-4 rounded relative overflow-hidden">
                                    <div class="text-[9px] text-gray-500 font-mono tracking-widest mb-1">VELOCITY</div>
                                    <div class="flex items-baseline gap-1">
                                        <div class="text-4xl font-mono font-bold text-cyan-400 leading-none neon-text" id="telemetry-speed">0</div>
                                        <span class="text-[10px] text-cyan-600 font-bold">KM/H</span>
                                    </div>
                                </div>
                                <div class="col-span-2 bg-slate-800/50 border-l-2 border-green-500 p-3 rounded flex items-center gap-4">
                                    <div class="h-8 w-8 rounded-full bg-green-900/50 flex items-center justify-center border border-green-500/30">
                                        <i class="fa-solid fa-location-crosshairs text-green-400 text-xs animate-spin-slow"></i>
                                    </div>
                                    <div>
                                        <div class="text-[9px] text-green-200/50 font-mono tracking-widest uppercase">Next Waypoint</div>
                                        <div class="font-bold text-sm text-white tracking-wide truncate w-56" id="telemetry-next">Awaiting Coordinates</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- OPERATOR VIEW -->
                    <div id="view-operator" class="view-section hidden space-y-4">
                        <div id="op-auth" class="bg-slate-800/40 p-6 rounded border border-gray-700 border-t-4 border-t-purple-500">
                            <h3 class="text-lg font-bold mb-4 text-purple-400 uppercase tracking-widest">Command Center</h3>
                            
                            <!-- Social Login -->
                            <div class="space-y-3 mb-6">
                                <button id="btn-google-op" class="w-full bg-white text-gray-900 p-3 rounded font-bold text-xs flex items-center justify-center gap-3 hover:bg-gray-200 transition">
                                    <i class="fa-brands fa-google text-red-500 text-lg"></i> Admin Access (Google)
                                </button>
                                <button id="btn-ms-op" class="w-full bg-[#00a4ef] text-white p-3 rounded font-bold text-xs flex items-center justify-center gap-3 hover:bg-[#0078d4] transition">
                                    <i class="fa-brands fa-microsoft text-white text-lg"></i> Admin Access (MS)
                                </button>
                            </div>

                            <form id="op-login-form" class="space-y-3 border-t border-gray-700 pt-4">
                                <input type="text" placeholder="ADMIN ID" id="op-login-user" class="w-full bg-slate-900 border border-gray-700 p-3 rounded text-xs text-white outline-none focus:border-purple-500 font-mono">
                                <input type="password" placeholder="SECURE KEY" id="op-login-pass" class="w-full bg-slate-900 border border-gray-700 p-3 rounded text-xs text-white outline-none focus:border-purple-500 font-mono">
                                <button type="submit" class="w-full bg-purple-600/20 text-purple-400 border border-purple-500/50 py-3 rounded text-xs font-bold tracking-widest hover:bg-purple-600/40 transition">ESTABLISH UPLINK</button>
                            </form>
                        </div>

                        <div id="op-dashboard" class="hidden space-y-4">
                            <div class="bg-purple-900/20 border border-purple-500/30 p-4 rounded flex justify-between items-center backdrop-blur-sm">
                                <div>
                                    <h2 class="font-bold text-lg text-white" id="op-company-display">HQ Dashboard</h2>
                                    <div class="flex items-center gap-2">
                                        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                        <p class="text-purple-300 text-[10px] font-mono tracking-widest">NETWORK SECURE</p>
                                    </div>
                                </div>
                                <button onclick="opLogout()" class="text-[10px] text-purple-300 border border-purple-500/50 px-3 py-1 rounded hover:bg-purple-500/20 transition">DISCONNECT</button>
                            </div>
                            <div class="bg-slate-800/40 rounded border border-gray-700 h-[300px] flex flex-col">
                                <div class="bg-slate-900/50 px-4 py-2 border-b border-gray-700 font-bold text-gray-400 text-[10px] uppercase tracking-widest shrink-0">Active Fleet Units</div>
                                <div id="fleet-list" class="divide-y divide-gray-800 overflow-y-auto custom-scrollbar flex-1">
                                    <div class="p-4 text-center text-gray-600 text-[10px] font-mono">FLEET IN GARRISON</div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                
                <!-- Footer -->
                <div class="p-3 text-center text-[9px] text-gray-600 bg-slate-900/80 border-t border-gray-800 font-mono">
                    The Metro Cavite v3.0 // <span class="text-cyan-900">SECURE CONNECTION</span>
                </div>
            </div>

            <!-- Toggle Handle Button -->
            <button onclick="toggleSidebar()" class="h-20 w-6 bg-slate-900 border-y border-r border-cyan-500/50 text-cyan-400 rounded-r-lg self-center flex items-center justify-center hover:bg-slate-800 focus:outline-none shadow-[5px_0_15px_rgba(0,0,0,0.5)] z-[2001] cursor-pointer">
                <i id="sidebar-icon" class="fa-solid fa-chevron-left text-xs transition-transform duration-300"></i>
            </button>

        </div>

        <!-- Right Side: The Map -->
        <div class="absolute inset-0 z-0" id="map-container">
            <div id="map" class="h-full w-full"></div>
            <!-- Map Overlay Controls -->
            <div class="absolute top-4 right-4 z-[1000] flex flex-col gap-2">
                <button id="traffic-toggle" onclick="toggleTrafficLayer()" class="traffic-control active">
                    <i class="fa-solid fa-traffic-light mr-2"></i> TRAFFIC
                </button>
            </div>
        </div>

    </div>

    <!-- Main Module -->
    <script type="module" src="app.js"></script>
    <script>
        // Sidebar Toggle Logic (Inline for immediate interaction)
        const sidebarWrapper = document.getElementById('sidebar-wrapper');
        const sidebarIcon = document.getElementById('sidebar-icon');
        let isSidebarOpen = true;

        window.toggleSidebar = function() {
            isSidebarOpen = !isSidebarOpen;
            if(isSidebarOpen) {
                sidebarWrapper.style.transform = 'translateX(0)';
                sidebarIcon.classList.remove('rotate-180');
            } else {
                // Approximate sidebar width (matches CSS)
                const w = window.innerWidth >= 768 ? '450px' : '85vw';
                sidebarWrapper.style.transform = `translateX(-${w})`;
                sidebarIcon.classList.add('rotate-180');
            }
        }
    </script>
</body>
</html>